import{EasyField as e}from"react-formutil";export*from"react-formutil";import r,{createContext as t,Children as n,cloneElement as i,Component as o}from"react";import{isValidElementType as a}from"react-is";import{Switch as u,Form as c,Checkbox as l,Radio as s,Transfer as f,Pagination as p,Upload as d}from"antd";import v from"react-fast-compare";function m(e,r,t){if(r in e){Object.defineProperty(e,r,{value:t,enumerable:true,configurable:true,writable:true})}else{e[r]=t}return e}function y(e){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){y=function e(r){return typeof r}}else{y=function e(r){return r&&typeof Symbol==="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r}}return y(e)}function h(e,r){if(y(e)!=="object"||e===null)return e;var t=e[Symbol.toPrimitive];if(t!==undefined){var n=t.call(e,r||"default");if(y(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(e)}function b(e){var r=h(e,"string");return y(r)==="symbol"?r:String(r)}function g(e,r){if(e==null)return{};var t={};var n=Object.keys(e);var i,o;for(o=0;o<n.length;o++){i=n[o];if(r.indexOf(i)>=0)continue;t[i]=e[i]}return t}function P(e,r){if(e==null)return{};var t=g(e,r);var n,i;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++){n=o[i];if(r.indexOf(n)>=0)continue;if(!Object.prototype.propertyIsEnumerable.call(e,n))continue;t[n]=e[n]}}return t}function k(e,r){if(!(e instanceof r)){throw new TypeError("Cannot call a class as a function")}}function O(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(e,n.key,n)}}function _(e,r,t){if(r)O(e.prototype,r);if(t)O(e,t);return e}function j(e){j=Object.setPrototypeOf?Object.getPrototypeOf:function e(r){return r.__proto__||Object.getPrototypeOf(r)};return j(e)}function w(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],(function(){})));return true}catch(e){return false}}function $(e){if(e===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return e}function E(e,r){if(r&&(y(r)==="object"||typeof r==="function")){return r}return $(e)}function S(e){return function(){var r=j(e),t;if(w()){var n=j(this).constructor;t=Reflect.construct(r,arguments,n)}else{t=r.apply(this,arguments)}return E(this,t)}}function C(e,r){C=Object.setPrototypeOf||function e(r,t){r.__proto__=t;return r};return C(e,r)}function V(e,r){if(typeof r!=="function"&&r!==null){throw new TypeError("Super expression must either be null or a function")}e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,writable:true,configurable:true}});if(r)C(e,r)}var F=t(),T=F.Consumer,N=F.Provider;var x=1;var R=function e(r){x=r};var A=u.name!=="Switch";var U=A?u:"Switch";var q=A?l:"Checkbox";var D=A?s:"Radio";var I=A?f:"Transfer";var L=A?p:"Pagination";var Y=A?d:"Upload";function B(e){if(e){var r=e.type;if(a(r)){if(r.formutilType){return r.formutilType}if(typeof r==="string"&&e.props.type){return e.props.type}if(!A){return r.displayName||r.name||r}}return r||e}}var H=function(t){V(a,t);var o=S(a);function a(){var e;k(this,a);for(var r=arguments.length,t=new Array(r),n=0;n<r;n++){t[n]=arguments[n]}e=o.call.apply(o,[this].concat(t));e.fields={};e.registerField=function(r,t){return t?e.fields[r]=t:delete e.fields[r]};e.latestValidationProps=null;e.checkHasError=function(e,r,t,n,i){switch(e){case 0:return r&&t&&n;case 1:return r&&t;case 2:return r;default:return false}};e.fetchCurrentValidationProps=function(r){var t=Object.keys(e.fields).map((function(r){return e.fields[r].$new()}));var n=t.filter((function(e){return e.$invalid}));var i=n.length>0;var o=t.some((function(e){return e.$dirty}));var a=t.some((function(e){return e.$touched}));var u=t.some((function(e){return e.$focused}));var c=n.map((function(e){return e.$getFirstError()}));return e.getValidationProps(r,i,o,a,u,c)};e.getValidationProps=function(r,t,n,i,o,a){var u=e.checkHasError(r,t,n,i,o);var c={className:[e.props.className,u&&"has-error",t?"is-invalid":"is-valid",n?"is-dirty":"is-pristine",i?"is-touched":"is-untouched",o?"is-focused":"is-unfocused"].filter(Boolean).join(" ")};if(u){Object.assign(c,{validateStatus:"error",help:a})}return c};return e}_(a,[{key:"componentDidMount",value:function e(){var r;(r=this.registerAncestorField)===null||r===void 0?void 0:r.call(this,this.props.name,this.$fieldutil)}},{key:"componentWillUnmount",value:function e(){var r;(r=this.registerAncestorField)===null||r===void 0?void 0:r.call(this,this.props.name,null)}},{key:"render",value:function t(){var o=this;var a=this.props;var u=a.children,l=a.itemProps,s=a.errorLevel,f=s===void 0?x:s,p=a.noStyle,d=P(a,["children","itemProps","errorLevel","noStyle"]);if(!a.name){var y=this.latestValidationProps=this.fetchCurrentValidationProps(f);Promise.resolve().then((function(){if(!v(o.latestValidationProps,o.fetchCurrentValidationProps(f))){o.forceUpdate()}}));return r.createElement(N,{value:this.registerField},r.createElement(c.Item,Object.assign({},d,y),u))}if(a.$memo===true){d.__DIFF__=u}var h=typeof u==="function"?u:n.only(u);var g=B(h);switch(g){case U:case q:case D:d.__TYPE__="checked";break;case L:if(!("$defaultValue"in d)){d.$defaultValue=1}break;case"checked":case"array":case"object":case"number":case"empty":d.__TYPE__=g;break;default:d.__TYPE__="empty";break}return r.createElement(e,Object.assign({},d,{passUtil:"$fieldutil",render:function e(t){var n,u,s;var v=a.valuePropName,y=v===void 0?"value":v,k=a.changePropName,O=k===void 0?"onChange":k,_=a.focusPropName,j=_===void 0?"onFocus":_,w=a.blurPropName,$=w===void 0?"onBlur":w;var E=t.$fieldutil,S=t[O],C=t[j],V=t[$],F=t[y],N=P(t,["$fieldutil",O,j,$,y].map(b));var x=E.$invalid,R=E.$dirty,A=E.$touched,B=E.$focused,H=E.$getFirstError;var K;switch(g){case U:case q:case D:case"checked":var M=a.checked,W=M===void 0?true:M,z=a.unchecked,G=z===void 0?false:z;K={checked:F===W,onChange:function e(r){var t=r&&r.target?r.target.checked:r;S(t?W:G,r)}};break;case I:K={targetKeys:F,onChange:S};break;case L:K={current:F,onChange:S};break;case Y:K={fileList:(n=F===null||F===void 0?void 0:F.fileList)!==null&&n!==void 0?n:F,onChange:S};break;default:K=(u={onCompositionEnd:function e(r){o.isComposition=false;delete o.compositionValue;S(r)},onCompositionStart:function e(){return o.isComposition=true}},m(u,O,(function(e){if(o.isComposition){o.compositionValue=e.target[y];o.forceUpdate()}else{for(var r=arguments.length,t=new Array(r>1?r-1:0),n=1;n<r;n++){t[n-1]=arguments[n]}S.apply(void 0,[e].concat(t))}})),m(u,y,"compositionValue"in o?o.compositionValue:F),u);break}Object.assign(K,(s={},m(s,j,C),m(s,$,V),s));if(!N.required&&d.required&&(!l||!("required"in l))){N.required=true}var J=typeof h==="function"?h(K):i(h,K);return r.createElement(T,null,(function(e){if(p){o.$fieldutil=E;o.registerAncestorField=e;return J}var t=o.getValidationProps(f,x,R,A,B,H());return r.createElement(c.Item,Object.assign({},N,l,t),J)}))}}))}}]);return a}(o);export{H as FormItem,R as setErrorLevel};
