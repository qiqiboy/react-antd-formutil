import{EasyField as e}from"react-formutil";export*from"react-formutil";import r from"@babel/runtime/helpers/esm/defineProperty";import t from"@babel/runtime/helpers/esm/toPropertyKey";import i from"@babel/runtime/helpers/esm/objectWithoutProperties";import o from"@babel/runtime/helpers/esm/classCallCheck";import n from"@babel/runtime/helpers/esm/createClass";import a from"@babel/runtime/helpers/esm/possibleConstructorReturn";import s from"@babel/runtime/helpers/esm/getPrototypeOf";import l from"@babel/runtime/helpers/esm/inherits";import c,{createContext as u,Children as f,cloneElement as m,Component as p}from"react";import{isValidElementType as d}from"react-is";import{Form as v,Pagination as h,Radio as b,Checkbox as g,Switch as y,Upload as P,Transfer as k}from"antd";import $ from"react-fast-compare";var C=u(),_=C.Consumer,V=C.Provider;var E=1;var F=function e(r){E=r};function j(e){if(e){var r=e.type;if(d(r)){if(r.formutilType){return r.formutilType}if(typeof r==="string"&&e.props.type){return e.props.type}}return r||e}}var O=function(u){l(p,u);function p(){var e;var r;o(this,p);for(var t=arguments.length,i=new Array(t),n=0;n<t;n++){i[n]=arguments[n]}r=a(this,(e=s(p)).call.apply(e,[this].concat(i)));r.fields={};r.registerField=function(e,t){return t?r.fields[e]=t:delete r.fields[e]};r.latestValidationProps=null;r.checkHasError=function(e,r,t,i,o){switch(e){case 0:return r&&t&&i;case 1:return r&&t;case 2:return r;default:return false}};r.fetchCurrentValidationProps=function(e){var t=Object.keys(r.fields).map(function(e){return r.fields[e].$new()});var i=t.filter(function(e){return e.$invalid});var o=i.length>0;var n=t.some(function(e){return e.$dirty});var a=t.some(function(e){return e.$touched});var s=t.some(function(e){return e.$focused});var l=i.map(function(e){return e.$getFirstError()});return r.getValidationProps(e,o,n,a,s,l)};r.getValidationProps=function(e,t,i,o,n,a){var s=r.checkHasError(e,t,i,o,n);var l={className:[r.props.className,s&&"has-error",t?"is-invalid":"is-valid",i?"is-dirty":"is-pristine",o?"is-touched":"is-untouched",n?"is-focused":"is-unfocused"].filter(Boolean).join(" ")};if(s){Object.assign(l,{validateStatus:"error",help:a})}return l};return r}n(p,[{key:"componentDidMount",value:function e(){var r;(r=this.registerAncestorField)===null||r===void 0?void 0:r.call(this,this.props.name,this.$fieldutil)}},{key:"componentWillUnmount",value:function e(){var r;(r=this.registerAncestorField)===null||r===void 0?void 0:r.call(this,this.props.name,null)}},{key:"render",value:function o(){var n=this;var a=this.props;var s=a.children,l=a.itemProps,u=a.errorLevel,p=u===void 0?E:u,d=a.noStyle,C=i(a,["children","itemProps","errorLevel","noStyle"]);if(!a.name){var F=this.latestValidationProps=this.fetchCurrentValidationProps(p);Promise.resolve().then(function(){if(!$(n.latestValidationProps,n.fetchCurrentValidationProps(p))){n.forceUpdate()}});return c.createElement(V,{value:this.registerField},c.createElement(v.Item,Object.assign({},C,F),s))}if(a.$memo===true){C.__DIFF__=s}var O=typeof s==="function"?s:f.only(s);var w=j(O);switch(w){case y:case g:case b:C.__TYPE__="checked";break;case h:if(!("$defaultValue"in C)){C.$defaultValue=1}break;case"checked":case"array":case"object":case"number":case"empty":C.__TYPE__=w;break;default:C.__TYPE__="empty";break}return c.createElement(e,Object.assign({},C,{passUtil:"$fieldutil",render:function e(o){var s,u,f;var $=a.valuePropName,V=$===void 0?"value":$,E=a.changePropName,F=E===void 0?"onChange":E,j=a.focusPropName,N=j===void 0?"onFocus":j,A=a.blurPropName,T=A===void 0?"onBlur":A;var q=o.$fieldutil,L=o[F],S=o[N],U=o[T],I=o[V],Y=i(o,["$fieldutil",F,N,T,V].map(t));var x=q.$invalid,B=q.$dirty,D=q.$touched,H=q.$focused,K=q.$getFirstError;var W;switch(w){case y:case g:case b:case"checked":var M=a.checked,R=M===void 0?true:M,z=a.unchecked,G=z===void 0?false:z;W={checked:I===R,onChange:function e(r){var t=r&&r.target?r.target.checked:r;L(t?R:G,r)}};break;case k:W={targetKeys:I,onChange:L};break;case h:W={current:I,onChange:L};break;case P:W={fileList:(s=I===null||I===void 0?void 0:I.fileList)!==null&&s!==void 0?s:I,onChange:L};break;default:W=(u={onCompositionEnd:function e(r){n.isComposition=false;delete n.compositionValue;L(r)},onCompositionStart:function e(){return n.isComposition=true}},r(u,F,function(e){if(n.isComposition){n.compositionValue=e.target[V];n.forceUpdate()}else{for(var r=arguments.length,t=new Array(r>1?r-1:0),i=1;i<r;i++){t[i-1]=arguments[i]}L.apply(void 0,[e].concat(t))}}),r(u,V,"compositionValue"in n?n.compositionValue:I),u);break}Object.assign(W,(f={},r(f,N,S),r(f,T,U),f));if(!Y.required&&C.required&&(!l||!("required"in l))){Y.required=true}var J=typeof O==="function"?O(W):m(O,W);return c.createElement(_,null,function(e){if(d){n.$fieldutil=q;n.registerAncestorField=e;return J}var r=n.getValidationProps(p,x,B,D,H,K());return c.createElement(v.Item,Object.assign({},Y,l,r),J)})}}))}}]);return p}(p);export{O as FormItem,F as setErrorLevel};
