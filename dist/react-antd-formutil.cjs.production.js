"use strict";Object.defineProperty(exports,"__esModule",{value:true});function e(e){return e&&typeof e==="object"&&"default"in e?e["default"]:e}var r=require("react-formutil");var t=e(require("@babel/runtime/helpers/defineProperty"));var i=e(require("@babel/runtime/helpers/toPropertyKey"));var a=e(require("@babel/runtime/helpers/objectWithoutProperties"));var n=e(require("@babel/runtime/helpers/classCallCheck"));var o=e(require("@babel/runtime/helpers/createClass"));var s=e(require("@babel/runtime/helpers/createSuper"));var u=e(require("@babel/runtime/helpers/inherits"));var l=require("react");var c=e(l);var d=require("react-is");var f=require("antd");var p=e(require("react-fast-compare"));var v=l.createContext(),h=v.Consumer,m=v.Provider;var b=1;var y=function e(r){b=r};function g(e){if(e){var r=e.type;if(d.isValidElementType(r)){if(r.formutilType){return r.formutilType}if(typeof r==="string"&&e.props.type){return e.props.type}}return r||e}}var P=function(e){u(v,e);var d=s(v);function v(){var e;n(this,v);for(var r=arguments.length,t=new Array(r),i=0;i<r;i++){t[i]=arguments[i]}e=d.call.apply(d,[this].concat(t));e.fields={};e.registerField=function(r,t){return t?e.fields[r]=t:delete e.fields[r]};e.latestValidationProps=null;e.checkHasError=function(e,r,t,i,a){switch(e){case 0:return r&&t&&i;case 1:return r&&t;case 2:return r;default:return false}};e.fetchCurrentValidationProps=function(r){var t=Object.keys(e.fields).map(function(r){return e.fields[r].$new()});var i=t.filter(function(e){return e.$invalid});var a=i.length>0;var n=t.some(function(e){return e.$dirty});var o=t.some(function(e){return e.$touched});var s=t.some(function(e){return e.$focused});var u=i.map(function(e){return e.$getFirstError()});return e.getValidationProps(r,a,n,o,s,u)};e.getValidationProps=function(r,t,i,a,n,o){var s=e.checkHasError(r,t,i,a,n);var u={className:[e.props.className,s&&"has-error",t?"is-invalid":"is-valid",i?"is-dirty":"is-pristine",a?"is-touched":"is-untouched",n?"is-focused":"is-unfocused"].filter(Boolean).join(" ")};if(s){Object.assign(u,{validateStatus:"error",help:o})}return u};return e}o(v,[{key:"componentDidMount",value:function e(){var r;(r=this.registerAncestorField)===null||r===void 0?void 0:r.call(this,this.props.name,this.$fieldutil)}},{key:"componentWillUnmount",value:function e(){var r;(r=this.registerAncestorField)===null||r===void 0?void 0:r.call(this,this.props.name,null)}},{key:"render",value:function e(){var n=this;var o=this.props;var s=o.children,u=o.itemProps,d=o.errorLevel,v=d===void 0?b:d,y=o.noStyle,P=a(o,["children","itemProps","errorLevel","noStyle"]);if(!o.name){var k=this.latestValidationProps=this.fetchCurrentValidationProps(v);Promise.resolve().then(function(){if(!p(n.latestValidationProps,n.fetchCurrentValidationProps(v))){n.forceUpdate()}});return c.createElement(m,{value:this.registerField},c.createElement(f.Form.Item,Object.assign({},P,k),s))}if(o.$memo===true){P.__DIFF__=s}var C=typeof s==="function"?s:l.Children.only(s);var $=g(C);switch($){case f.Switch:case f.Checkbox:case f.Radio:P.__TYPE__="checked";break;case f.Pagination:if(!("$defaultValue"in P)){P.$defaultValue=1}break;case"checked":case"array":case"object":case"number":case"empty":P.__TYPE__=$;break;default:P.__TYPE__="empty";break}return c.createElement(r.EasyField,Object.assign({},P,{passUtil:"$fieldutil",render:function e(r){var s,d,p;var m=o.valuePropName,b=m===void 0?"value":m,g=o.changePropName,k=g===void 0?"onChange":g,E=o.focusPropName,_=E===void 0?"onFocus":E,q=o.blurPropName,V=q===void 0?"onBlur":q;var F=r.$fieldutil,j=r[k],O=r[_],w=r[V],x=r[b],S=a(r,["$fieldutil",k,_,V,b].map(i));var T=F.$invalid,N=F.$dirty,A=F.$touched,L=F.$focused,U=F.$getFirstError;var I;switch($){case f.Switch:case f.Checkbox:case f.Radio:case"checked":var Y=o.checked,B=Y===void 0?true:Y,D=o.unchecked,H=D===void 0?false:D;I={checked:x===B,onChange:function e(r){var t=r&&r.target?r.target.checked:r;j(t?B:H,r)}};break;case f.Transfer:I={targetKeys:x,onChange:j};break;case f.Pagination:I={current:x,onChange:j};break;case f.Upload:I={fileList:(s=x===null||x===void 0?void 0:x.fileList)!==null&&s!==void 0?s:x,onChange:j};break;default:I=(d={onCompositionEnd:function e(r){n.isComposition=false;delete n.compositionValue;j(r)},onCompositionStart:function e(){return n.isComposition=true}},t(d,k,function(e){if(n.isComposition){n.compositionValue=e.target[b];n.forceUpdate()}else{for(var r=arguments.length,t=new Array(r>1?r-1:0),i=1;i<r;i++){t[i-1]=arguments[i]}j.apply(void 0,[e].concat(t))}}),t(d,b,"compositionValue"in n?n.compositionValue:x),d);break}Object.assign(I,(p={},t(p,_,O),t(p,V,w),p));if(!S.required&&P.required&&(!u||!("required"in u))){S.required=true}var K=typeof C==="function"?C(I):l.cloneElement(C,I);return c.createElement(h,null,function(e){if(y){n.$fieldutil=F;n.registerAncestorField=e;return K}var r=n.getValidationProps(v,T,N,A,L,U());return c.createElement(f.Form.Item,Object.assign({},S,u,r),K)})}}))}}]);return v}(l.Component);Object.keys(r).forEach(function(e){if(e!=="default")Object.defineProperty(exports,e,{enumerable:true,get:function(){return r[e]}})});exports.FormItem=P;exports.setErrorLevel=y;
