import{EasyField as e}from"react-formutil";export*from"react-formutil";import r from"@babel/runtime/helpers/esm/defineProperty";import t from"@babel/runtime/helpers/esm/toPropertyKey";import i from"@babel/runtime/helpers/esm/objectWithoutProperties";import o from"@babel/runtime/helpers/esm/classCallCheck";import a from"@babel/runtime/helpers/esm/createClass";import n from"@babel/runtime/helpers/esm/possibleConstructorReturn";import s from"@babel/runtime/helpers/esm/getPrototypeOf";import l from"@babel/runtime/helpers/esm/inherits";import c,{createContext as u,Children as f,cloneElement as m,Component as d}from"react";import{isValidElementType as p}from"react-is";import{Switch as v,Form as h,Checkbox as b,Radio as g,Transfer as y,Pagination as P,Upload as k}from"antd";import C from"react-fast-compare";var $=u({}),V=$.Consumer,E=$.Provider;var _=1;var F=function e(r){_=r};var j=v.name!=="Switch";var w=j?v:"Switch";var N=j?b:"Checkbox";var O=j?g:"Radio";var S=j?y:"Transfer";var T=j?P:"Pagination";var A=j?k:"Upload";function U(e){if(e){var r;var t=e.type;if(typeof t!=="string"&&p(t)){if(t.formutilType){return t.formutilType}if(j){return t}return t.displayName||t.name}return((r=e.props)===null||r===void 0?void 0:r.type)||t}}var L=function(u){l(d,u);function d(){var e;var r;o(this,d);for(var t=arguments.length,i=new Array(t),a=0;a<t;a++){i[a]=arguments[a]}r=n(this,(e=s(d)).call.apply(e,[this].concat(i)));r.fields={};r.registerField=function(e,t){return t?r.fields[e]=t:delete r.fields[e]};r.latestValidationProps=null;r.checkHasError=function(e,r,t,i,o){switch(e){case 0:return r&&t&&i;case 1:return r&&t;case 2:return r;default:return false}};r.fetchCurrentValidationProps=function(e){var t=Object.keys(r.fields).map(function(e){return r.fields[e].$new()});var i=t.filter(function(e){return e.$invalid});var o=i.length>0;var a=t.some(function(e){return e.$dirty});var n=t.some(function(e){return e.$touched});var s=t.some(function(e){return e.$focused});var l=i.map(function(e){return e.$getFirstError()});return r.getValidationProps(e,o,a,n,s,l)};r.getValidationProps=function(e,t,i,o,a,n){var s=r.checkHasError(e,t,i,o,a);var l={className:[r.props.className,s&&"has-error",t?"is-invalid":"is-valid",i?"is-dirty":"is-pristine",o?"is-touched":"is-untouched",a?"is-focused":"is-unfocused"].filter(Boolean).join(" ")};if(s){Object.assign(l,{validateStatus:"error",help:n})}return l};return r}a(d,[{key:"componentDidMount",value:function e(){var r;(r=this.registerAncestorField)===null||r===void 0?void 0:r.call(this,this.props.name,this.$fieldutil)}},{key:"componentWillUnmount",value:function e(){var r;(r=this.registerAncestorField)===null||r===void 0?void 0:r.call(this,this.props.name,null)}},{key:"render",value:function o(){var a=this;var n=this.props;var s=n.children,l=n.itemProps,u=n.errorLevel,d=u===void 0?_:u,p=n.noStyle,v=i(n,["children","itemProps","errorLevel","noStyle"]);if(!n.name){var b=this.latestValidationProps=this.fetchCurrentValidationProps(d);Promise.resolve().then(function(){if(!C(a.latestValidationProps,a.fetchCurrentValidationProps(d))){a.forceUpdate()}});return c.createElement(E,{value:{registerField:this.registerField}},c.createElement(h.Item,Object.assign({},v,b),s))}var g=typeof s==="function"?s:f.only(s);var y=U(g);switch(y){case w:case N:case O:v.__TYPE__="checked";break;case T:if(!("$defaultValue"in v)){v.$defaultValue=1}break;case"checked":case"array":case"object":case"number":case"empty":v.__TYPE__=y;break;default:v.__TYPE__="empty";break}return c.createElement(e,Object.assign({},v,{passUtil:"$fieldutil",render:function e(o){var s,u,f;var v=n.valuePropName,b=v===void 0?"value":v,P=n.changePropName,k=P===void 0?"onChange":P,C=n.focusPropName,$=C===void 0?"onFocus":C,E=n.blurPropName,_=E===void 0?"onBlur":E;var F=o.$fieldutil,j=o[k],U=o[$],L=o[_],x=o[b],Y=i(o,["$fieldutil",k,$,_,b].map(t));var B=F.$invalid,H=F.$dirty,I=F.$touched,K=F.$focused,R=F.$getFirstError;var W;switch(y){case w:case N:case O:case"checked":var q=n.checked,D=q===void 0?true:q,M=n.unchecked,z=M===void 0?false:M;W={checked:x===D,onChange:function e(r){var t=r&&r.target?r.target.checked:r;j(t?D:z,r)}};break;case S:W={targetKeys:x,onChange:j};break;case T:W={current:x,onChange:j};break;case A:W={fileList:(s=x===null||x===void 0?void 0:x.fileList)!==null&&s!==void 0?s:x,onChange:j};break;default:W=(u={onCompositionEnd:function e(r){a.isComposition=false;delete a.compositionValue;j(r)},onCompositionStart:function e(){return a.isComposition=true}},r(u,k,function(e){if(a.isComposition){a.compositionValue=e.target[b];a.forceUpdate()}else{for(var r=arguments.length,t=new Array(r>1?r-1:0),i=1;i<r;i++){t[i-1]=arguments[i]}j.apply(void 0,[e].concat(t))}}),r(u,b,"compositionValue"in a?a.compositionValue:x),u);break}Object.assign(W,(f={},r(f,$,U),r(f,_,L),f));var G=typeof g==="function"?g(W):m(g,W);return c.createElement(V,null,function(e){var r=e.registerField;if(p){a.$fieldutil=F;a.registerAncestorField=r;return G}var t=a.getValidationProps(d,B,H,I,K,R());return c.createElement(h.Item,Object.assign({required:false},Y,l,t),G)})}}))}}]);return d}(d);export{L as FormItem,F as setErrorLevel};
