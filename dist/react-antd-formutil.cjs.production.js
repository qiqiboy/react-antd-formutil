"use strict";Object.defineProperty(exports,"__esModule",{value:true});var e=require("react-formutil");var r=require("react");var t=require("antd");var n=require("react-is");var o=require("react-fast-compare");function i(e){return e&&typeof e==="object"&&"default"in e?e:{default:e}}var a=i(r);var u=i(n);var c=i(o);function l(e,r,t){if(r in e){Object.defineProperty(e,r,{value:t,enumerable:true,configurable:true,writable:true})}else{e[r]=t}return e}var s=l;function f(e,r){return r={exports:{}},e(r,r.exports),r.exports}var p=f((function(e){function r(t){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){e.exports=r=function e(r){return typeof r}}else{e.exports=r=function e(r){return r&&typeof Symbol==="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r}}return r(t)}e.exports=r}));function v(e,r){if(p(e)!=="object"||e===null)return e;var t=e[Symbol.toPrimitive];if(t!==undefined){var n=t.call(e,r||"default");if(p(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(e)}var d=v;function m(e){var r=d(e,"string");return p(r)==="symbol"?r:String(r)}var y=m;function h(e,r){if(e==null)return{};var t={};var n=Object.keys(e);var o,i;for(i=0;i<n.length;i++){o=n[i];if(r.indexOf(o)>=0)continue;t[o]=e[o]}return t}var b=h;function g(e,r){if(e==null)return{};var t=b(e,r);var n,o;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(o=0;o<i.length;o++){n=i[o];if(r.indexOf(n)>=0)continue;if(!Object.prototype.propertyIsEnumerable.call(e,n))continue;t[n]=e[n]}}return t}var P=g;function k(e,r){if(!(e instanceof r)){throw new TypeError("Cannot call a class as a function")}}var O=k;function j(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(e,n.key,n)}}function C(e,r,t){if(r)j(e.prototype,r);if(t)j(e,t);return e}var _=C;var E=f((function(e){function r(t,n){e.exports=r=Object.setPrototypeOf||function e(r,t){r.__proto__=t;return r};return r(t,n)}e.exports=r}));function x(e,r){if(typeof r!=="function"&&r!==null){throw new TypeError("Super expression must either be null or a function")}e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,writable:true,configurable:true}});if(r)E(e,r)}var S=x;var $=f((function(e){function r(t){e.exports=r=Object.setPrototypeOf?Object.getPrototypeOf:function e(r){return r.__proto__||Object.getPrototypeOf(r)};return r(t)}e.exports=r}));function w(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],(function(){})));return true}catch(e){return false}}var V=w;function F(e){if(e===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return e}var T=F;function q(e,r){if(r&&(p(r)==="object"||typeof r==="function")){return r}return T(e)}var N=q;function R(e){var r=V();return function t(){var n=$(e),o;if(r){var i=$(this).constructor;o=Reflect.construct(n,arguments,i)}else{o=n.apply(this,arguments)}return N(this,o)}}var A=R;var I=u["default"].isValidElementType;var L=r.createContext(),U=L.Consumer,D=L.Provider;var Y=1;var B=function e(r){Y=r};var H=t.Checkbox.name!=="Checkbox";var M=H?t.Switch:"Switch";var K=H?t.Checkbox:"Checkbox";var W=H?t.Radio:"Radio";var z=H?t.Transfer:"Transfer";var G=H?t.Pagination:"Pagination";var J=H?t.Upload:"Upload";var Q=H?t.Select:"Select";function X(e){if(e){var r=e.type;if(I(r)){if(r.formutilType){return r.formutilType}if(typeof r==="string"&&e.props.type){return e.props.type}if(!H){var t;var n=r.displayName||r.name;if(n){return n}if(((t=r.render)===null||t===void 0?void 0:t.name)==="InternalSelect"){return"Select"}return r}}return r||e}}var Z=function(n){S(i,n);var o=A(i);function i(){var e;O(this,i);for(var r=arguments.length,t=new Array(r),n=0;n<r;n++){t[n]=arguments[n]}e=o.call.apply(o,[this].concat(t));e.fields={};e.registerField=function(r,t){return t?e.fields[r]=t:delete e.fields[r]};e.latestValidationProps=null;e.checkHasError=function(e,r,t,n,o){switch(e){case 0:return r&&t&&n;case 1:return r&&t;case 2:return r;default:return false}};e.fetchCurrentValidationProps=function(r){var t=Object.keys(e.fields).map((function(r){return e.fields[r].$new()}));var n=t.filter((function(e){return e.$invalid}));var o=n.length>0;var i=t.some((function(e){return e.$dirty}));var a=t.some((function(e){return e.$touched}));var u=t.some((function(e){return e.$focused}));var c=n.map((function(e){return e.$getFirstError()}));return e.getValidationProps(r,o,i,a,u,c)};e.getValidationProps=function(r,t,n,o,i,a){var u=e.checkHasError(r,t,n,o,i);var c={className:[e.props.className,u&&"has-error",t?"is-invalid":"is-valid",n?"is-dirty":"is-pristine",o?"is-touched":"is-untouched",i?"is-focused":"is-unfocused"].filter(Boolean).join(" ")};if(u){Object.assign(c,{validateStatus:"error",help:a})}return c};return e}_(i,[{key:"componentDidMount",value:function e(){var r;(r=this.registerAncestorField)===null||r===void 0?void 0:r.call(this,this.props.name,this.$fieldutil)}},{key:"componentWillUnmount",value:function e(){var r;(r=this.registerAncestorField)===null||r===void 0?void 0:r.call(this,this.props.name,null)}},{key:"render",value:function n(){var o=this;var i=this.props;var u=i.children,l=i.itemProps,f=i.errorLevel,p=f===void 0?Y:f,v=i.noStyle,d=P(i,["children","itemProps","errorLevel","noStyle"]);if(!i.name){var m=this.latestValidationProps=this.fetchCurrentValidationProps(p);Promise.resolve().then((function(){if(!c["default"](o.latestValidationProps,o.fetchCurrentValidationProps(p))){o.forceUpdate()}}));return a["default"].createElement(D,{value:this.registerField},a["default"].createElement(t.Form.Item,Object.assign({},d,m),typeof u==="function"?u():u))}if(d.$memo===true){d.__DIFF__={childList:u,compositionValue:this.compositionValue}}else if(Array.isArray(d.$memo)){d.$memo=d.$memo.concat(this.compositionValue)}var h=typeof u==="function"?u:r.Children.only(u);var b=X(h);switch(b){case M:case K:case W:d.__TYPE__="checked";break;case G:if(!("$defaultValue"in d)){d.$defaultValue=1}break;case"checked":case"array":case"object":case"number":case"empty":d.__TYPE__=b;break;default:d.__TYPE__="empty";break}return a["default"].createElement(e.EasyField,Object.assign({},d,{passUtil:"$fieldutil",render:function e(n){var u,c,f;var m=i.valuePropName,g=m===void 0?"value":m,k=i.changePropName,O=k===void 0?"onChange":k,j=i.focusPropName,C=j===void 0?"onFocus":j,_=i.blurPropName,E=_===void 0?"onBlur":_;var x=n.$fieldutil,S=n[O],$=n[C],w=n[E],V=n[g],F=P(n,["$fieldutil",O,C,E,g].map(y));var T=x.$invalid,q=x.$dirty,N=x.$touched,R=x.$focused,A=x.$getFirstError;var I;switch(b){case M:case K:case W:case"checked":var L=i.checked,D=L===void 0?true:L,Y=i.unchecked,B=Y===void 0?false:Y;I={checked:V===D,onChange:function e(r){var t=r&&r.target?r.target.checked:r;S(t?D:B,r)}};break;case z:I={targetKeys:V,onChange:S};break;case G:I={current:V,onChange:S};break;case J:I={fileList:(u=V===null||V===void 0?void 0:V.fileList)!==null&&u!==void 0?u:V,onChange:S};break;default:I=(c={onCompositionEnd:function e(r){o.isComposing=false;delete o.compositionValue;S(r)},onCompositionStart:function e(){return o.isComposing=true}},s(c,O,(function(e){if(o.isComposing){var r,t;o.compositionValue=(r=(t=e.target)===null||t===void 0?void 0:t[g])!==null&&r!==void 0?r:e;o.forceUpdate()}else{for(var n=arguments.length,i=new Array(n>1?n-1:0),a=1;a<n;a++){i[a-1]=arguments[a]}S.apply(void 0,[e].concat(i))}})),s(c,g,"compositionValue"in o?o.compositionValue:V),s(c,E,(function(){if(o.isComposing){o.isComposing=false;delete o.compositionValue;S.apply(void 0,arguments)}return w.apply(void 0,arguments)})),c);break}if(b===Q){delete I.onCompositionStart;delete I.onCompositionEnd}I=Object.assign((f={},s(f,C,$),s(f,E,w),f),I);if(!F.required&&d.required&&(!l||!("required"in l))){F.required=true}var H=typeof h==="function"?h(I):r.cloneElement(h,I);return a["default"].createElement(U,null,(function(e){if(v){o.$fieldutil=x;o.registerAncestorField=e;return H}var r=o.getValidationProps(p,T,q,N,R,A());return a["default"].createElement(t.Form.Item,Object.assign({},F,l,r),H)}))}}))}}]);return i}(r.Component);Object.keys(e).forEach((function(r){if(r!=="default")Object.defineProperty(exports,r,{enumerable:true,get:function(){return e[r]}})}));exports.FormItem=Z;exports.setErrorLevel=B;
