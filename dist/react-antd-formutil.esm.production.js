import{EasyField as e}from"react-formutil";export*from"react-formutil";import t,{Children as r,cloneElement as n,Component as o,createContext as i}from"react";import{Select as a,Form as u,Switch as c,Checkbox as l,Radio as s,Transfer as f,Pagination as p,Upload as d}from"antd";import v from"react-is";import m from"react-fast-compare";function y(e,t,r){if(t in e){Object.defineProperty(e,t,{value:r,enumerable:true,configurable:true,writable:true})}else{e[t]=r}return e}function h(e){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){h=function e(t){return typeof t}}else{h=function e(t){return t&&typeof Symbol==="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t}}return h(e)}function b(e,t){if(h(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==undefined){var n=r.call(e,t||"default");if(h(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function g(e){var t=b(e,"string");return h(t)==="symbol"?t:String(t)}function P(e,t){if(e==null)return{};var r={};var n=Object.keys(e);var o,i;for(i=0;i<n.length;i++){o=n[i];if(t.indexOf(o)>=0)continue;r[o]=e[o]}return r}function k(e,t){if(e==null)return{};var r=P(e,t);var n,o;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(o=0;o<i.length;o++){n=i[o];if(t.indexOf(n)>=0)continue;if(!Object.prototype.propertyIsEnumerable.call(e,n))continue;r[n]=e[n]}}return r}function O(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function _(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(e,n.key,n)}}function j(e,t,r){if(t)_(e.prototype,t);if(r)_(e,r);return e}function w(e,t){w=Object.setPrototypeOf||function e(t,r){t.__proto__=r;return t};return w(e,t)}function C(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function")}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:true,configurable:true}});if(t)w(e,t)}function E(e){E=Object.setPrototypeOf?Object.getPrototypeOf:function e(t){return t.__proto__||Object.getPrototypeOf(t)};return E(e)}function S(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],(function(){})));return true}catch(e){return false}}function $(e){if(e===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return e}function V(e,t){if(t&&(h(t)==="object"||typeof t==="function")){return t}return $(e)}function F(e){var t=S();return function r(){var n=E(e),o;if(t){var i=E(this).constructor;o=Reflect.construct(n,arguments,i)}else{o=n.apply(this,arguments)}return V(this,o)}}var T=v.isValidElementType;var N=i(),x=N.Consumer,R=N.Provider;var A=1;var U=function e(t){A=t};var q=a.name!=="Select";var D=q?c:"Switch";var I=q?l:"Checkbox";var L=q?s:"Radio";var Y=q?f:"Transfer";var B=q?p:"Pagination";var H=q?d:"Upload";var K=q?a:"Select";function M(e){if(e){var t=e.type;if(T(t)){if(t.formutilType){return t.formutilType}if(typeof t==="string"&&e.props.type){return e.props.type}if(!q){return t.displayName||t.name||t}}return t||e}}var W=function(o){C(a,o);var i=F(a);function a(){var e;O(this,a);for(var t=arguments.length,r=new Array(t),n=0;n<t;n++){r[n]=arguments[n]}e=i.call.apply(i,[this].concat(r));e.fields={};e.registerField=function(t,r){return r?e.fields[t]=r:delete e.fields[t]};e.latestValidationProps=null;e.checkHasError=function(e,t,r,n,o){switch(e){case 0:return t&&r&&n;case 1:return t&&r;case 2:return t;default:return false}};e.fetchCurrentValidationProps=function(t){var r=Object.keys(e.fields).map((function(t){return e.fields[t].$new()}));var n=r.filter((function(e){return e.$invalid}));var o=n.length>0;var i=r.some((function(e){return e.$dirty}));var a=r.some((function(e){return e.$touched}));var u=r.some((function(e){return e.$focused}));var c=n.map((function(e){return e.$getFirstError()}));return e.getValidationProps(t,o,i,a,u,c)};e.getValidationProps=function(t,r,n,o,i,a){var u=e.checkHasError(t,r,n,o,i);var c={className:[e.props.className,u&&"has-error",r?"is-invalid":"is-valid",n?"is-dirty":"is-pristine",o?"is-touched":"is-untouched",i?"is-focused":"is-unfocused"].filter(Boolean).join(" ")};if(u){Object.assign(c,{validateStatus:"error",help:a})}return c};return e}j(a,[{key:"componentDidMount",value:function e(){var t;(t=this.registerAncestorField)===null||t===void 0?void 0:t.call(this,this.props.name,this.$fieldutil)}},{key:"componentWillUnmount",value:function e(){var t;(t=this.registerAncestorField)===null||t===void 0?void 0:t.call(this,this.props.name,null)}},{key:"render",value:function o(){var i=this;var a=this.props;var c=a.children,l=a.itemProps,s=a.errorLevel,f=s===void 0?A:s,p=a.noStyle,d=k(a,["children","itemProps","errorLevel","noStyle"]);if(!a.name){var v=this.latestValidationProps=this.fetchCurrentValidationProps(f);Promise.resolve().then((function(){if(!m(i.latestValidationProps,i.fetchCurrentValidationProps(f))){i.forceUpdate()}}));return t.createElement(R,{value:this.registerField},t.createElement(u.Item,Object.assign({},d,v),typeof c==="function"?c():c))}if(a.$memo===true){d.__DIFF__=c}var h=typeof c==="function"?c:r.only(c);var b=M(h);switch(b){case D:case I:case L:d.__TYPE__="checked";break;case B:if(!("$defaultValue"in d)){d.$defaultValue=1}break;case"checked":case"array":case"object":case"number":case"empty":d.__TYPE__=b;break;default:d.__TYPE__="empty";break}return t.createElement(e,Object.assign({},d,{passUtil:"$fieldutil",render:function e(r){var o,c,s;var v=a.valuePropName,m=v===void 0?"value":v,P=a.changePropName,O=P===void 0?"onChange":P,_=a.focusPropName,j=_===void 0?"onFocus":_,w=a.blurPropName,C=w===void 0?"onBlur":w;var E=r.$fieldutil,S=r[O],$=r[j],V=r[C],F=r[m],T=k(r,["$fieldutil",O,j,C,m].map(g));var N=E.$invalid,R=E.$dirty,A=E.$touched,U=E.$focused,q=E.$getFirstError;var M;switch(b){case D:case I:case L:case"checked":var W=a.checked,z=W===void 0?true:W,G=a.unchecked,J=G===void 0?false:G;M={checked:F===z,onChange:function e(t){var r=t&&t.target?t.target.checked:t;S(r?z:J,t)}};break;case Y:M={targetKeys:F,onChange:S};break;case B:M={current:F,onChange:S};break;case H:M={fileList:(o=F===null||F===void 0?void 0:F.fileList)!==null&&o!==void 0?o:F,onChange:S};break;default:M=(c={onCompositionEnd:function e(t){i.isComposition=false;delete i.compositionValue;S(t)},onCompositionStart:function e(){return i.isComposition=true}},y(c,O,(function(e){if(i.isComposition){var t,r;i.compositionValue=(t=(r=e.target)===null||r===void 0?void 0:r[m])!==null&&t!==void 0?t:e;i.forceUpdate()}else{for(var n=arguments.length,o=new Array(n>1?n-1:0),a=1;a<n;a++){o[a-1]=arguments[a]}S.apply(void 0,[e].concat(o))}})),y(c,m,"compositionValue"in i?i.compositionValue:F),y(c,C,(function(){if(i.isComposition){i.isComposition=false;delete i.compositionValue;S.apply(void 0,arguments)}return V.apply(void 0,arguments)})),c);break}if(b===K){delete M.onCompositionStart;delete M.onCompositionEnd}M=Object.assign((s={},y(s,j,$),y(s,C,V),s),M);if(!T.required&&d.required&&(!l||!("required"in l))){T.required=true}var Q=typeof h==="function"?h(M):n(h,M);return t.createElement(x,null,(function(e){if(p){i.$fieldutil=E;i.registerAncestorField=e;return Q}var r=i.getValidationProps(f,N,R,A,U,q());return t.createElement(u.Item,Object.assign({},T,l,r),Q)}))}}))}}]);return a}(o);export{W as FormItem,U as setErrorLevel};
