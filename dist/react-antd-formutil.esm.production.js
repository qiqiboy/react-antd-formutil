import{EasyField as e}from"react-formutil";export*from"react-formutil";import t,{createContext as r,Children as n,cloneElement as o,Component as i}from"react";import{isValidElementType as a}from"react-is";import{Switch as u,Form as c,Checkbox as l,Radio as s,Transfer as f,Pagination as p,Upload as d}from"antd";import v from"react-fast-compare";function m(e,t,r){if(t in e){Object.defineProperty(e,t,{value:r,enumerable:true,configurable:true,writable:true})}else{e[t]=r}return e}function y(e){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){y=function e(t){return typeof t}}else{y=function e(t){return t&&typeof Symbol==="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t}}return y(e)}function h(e,t){if(y(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==undefined){var n=r.call(e,t||"default");if(y(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function b(e){var t=h(e,"string");return y(t)==="symbol"?t:String(t)}function g(e,t){if(e==null)return{};var r={};var n=Object.keys(e);var o,i;for(i=0;i<n.length;i++){o=n[i];if(t.indexOf(o)>=0)continue;r[o]=e[o]}return r}function P(e,t){if(e==null)return{};var r=g(e,t);var n,o;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(o=0;o<i.length;o++){n=i[o];if(t.indexOf(n)>=0)continue;if(!Object.prototype.propertyIsEnumerable.call(e,n))continue;r[n]=e[n]}}return r}function k(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function O(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(e,n.key,n)}}function _(e,t,r){if(t)O(e.prototype,t);if(r)O(e,r);return e}function j(e){j=Object.setPrototypeOf?Object.getPrototypeOf:function e(t){return t.__proto__||Object.getPrototypeOf(t)};return j(e)}function w(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],(function(){})));return true}catch(e){return false}}function $(e){if(e===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return e}function C(e,t){if(t&&(y(t)==="object"||typeof t==="function")){return t}return $(e)}function E(e){return function(){var t=j(e),r;if(w()){var n=j(this).constructor;r=Reflect.construct(t,arguments,n)}else{r=t.apply(this,arguments)}return C(this,r)}}function S(e,t){S=Object.setPrototypeOf||function e(t,r){t.__proto__=r;return t};return S(e,t)}function V(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function")}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:true,configurable:true}});if(t)S(e,t)}var F=r(),T=F.Consumer,N=F.Provider;var x=1;var R=function e(t){x=t};var A=u.name!=="Switch";var U=A?u:"Switch";var q=A?l:"Checkbox";var D=A?s:"Radio";var I=A?f:"Transfer";var L=A?p:"Pagination";var Y=A?d:"Upload";function B(e){if(e){var t=e.type;if(a(t)){if(t.formutilType){return t.formutilType}if(typeof t==="string"&&e.props.type){return e.props.type}if(!A){return t.displayName||t.name||t}}return t||e}}var H=function(r){V(a,r);var i=E(a);function a(){var e;k(this,a);for(var t=arguments.length,r=new Array(t),n=0;n<t;n++){r[n]=arguments[n]}e=i.call.apply(i,[this].concat(r));e.fields={};e.registerField=function(t,r){return r?e.fields[t]=r:delete e.fields[t]};e.latestValidationProps=null;e.checkHasError=function(e,t,r,n,o){switch(e){case 0:return t&&r&&n;case 1:return t&&r;case 2:return t;default:return false}};e.fetchCurrentValidationProps=function(t){var r=Object.keys(e.fields).map((function(t){return e.fields[t].$new()}));var n=r.filter((function(e){return e.$invalid}));var o=n.length>0;var i=r.some((function(e){return e.$dirty}));var a=r.some((function(e){return e.$touched}));var u=r.some((function(e){return e.$focused}));var c=n.map((function(e){return e.$getFirstError()}));return e.getValidationProps(t,o,i,a,u,c)};e.getValidationProps=function(t,r,n,o,i,a){var u=e.checkHasError(t,r,n,o,i);var c={className:[e.props.className,u&&"has-error",r?"is-invalid":"is-valid",n?"is-dirty":"is-pristine",o?"is-touched":"is-untouched",i?"is-focused":"is-unfocused"].filter(Boolean).join(" ")};if(u){Object.assign(c,{validateStatus:"error",help:a})}return c};return e}_(a,[{key:"componentDidMount",value:function e(){var t;(t=this.registerAncestorField)===null||t===void 0?void 0:t.call(this,this.props.name,this.$fieldutil)}},{key:"componentWillUnmount",value:function e(){var t;(t=this.registerAncestorField)===null||t===void 0?void 0:t.call(this,this.props.name,null)}},{key:"render",value:function r(){var i=this;var a=this.props;var u=a.children,l=a.itemProps,s=a.errorLevel,f=s===void 0?x:s,p=a.noStyle,d=P(a,["children","itemProps","errorLevel","noStyle"]);if(!a.name){var y=this.latestValidationProps=this.fetchCurrentValidationProps(f);Promise.resolve().then((function(){if(!v(i.latestValidationProps,i.fetchCurrentValidationProps(f))){i.forceUpdate()}}));return t.createElement(N,{value:this.registerField},t.createElement(c.Item,Object.assign({},d,y),typeof u==="function"?u():u))}if(a.$memo===true){d.__DIFF__=u}var h=typeof u==="function"?u:n.only(u);var g=B(h);switch(g){case U:case q:case D:d.__TYPE__="checked";break;case L:if(!("$defaultValue"in d)){d.$defaultValue=1}break;case"checked":case"array":case"object":case"number":case"empty":d.__TYPE__=g;break;default:d.__TYPE__="empty";break}return t.createElement(e,Object.assign({},d,{passUtil:"$fieldutil",render:function e(r){var n,u,s;var v=a.valuePropName,y=v===void 0?"value":v,k=a.changePropName,O=k===void 0?"onChange":k,_=a.focusPropName,j=_===void 0?"onFocus":_,w=a.blurPropName,$=w===void 0?"onBlur":w;var C=r.$fieldutil,E=r[O],S=r[j],V=r[$],F=r[y],N=P(r,["$fieldutil",O,j,$,y].map(b));var x=C.$invalid,R=C.$dirty,A=C.$touched,B=C.$focused,H=C.$getFirstError;var K;switch(g){case U:case q:case D:case"checked":var M=a.checked,W=M===void 0?true:M,z=a.unchecked,G=z===void 0?false:z;K={checked:F===W,onChange:function e(t){var r=t&&t.target?t.target.checked:t;E(r?W:G,t)}};break;case I:K={targetKeys:F,onChange:E};break;case L:K={current:F,onChange:E};break;case Y:K={fileList:(n=F===null||F===void 0?void 0:F.fileList)!==null&&n!==void 0?n:F,onChange:E};break;default:K=(u={onCompositionEnd:function e(t){i.isComposition=false;delete i.compositionValue;E(t)},onCompositionStart:function e(){return i.isComposition=true}},m(u,O,(function(e){if(i.isComposition){i.compositionValue=e.target[y];i.forceUpdate()}else{for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++){r[n-1]=arguments[n]}E.apply(void 0,[e].concat(r))}})),m(u,y,"compositionValue"in i?i.compositionValue:F),m(u,$,(function(){if(i.isComposition){i.isComposition=false;delete i.compositionValue;E.apply(void 0,arguments)}return V.apply(void 0,arguments)})),u);break}Object.assign((s={},m(s,j,S),m(s,$,V),s),K);if(!N.required&&d.required&&(!l||!("required"in l))){N.required=true}var J=typeof h==="function"?h(K):o(h,K);return t.createElement(T,null,(function(e){if(p){i.$fieldutil=C;i.registerAncestorField=e;return J}var r=i.getValidationProps(f,x,R,A,B,H());return t.createElement(c.Item,Object.assign({},N,l,r),J)}))}}))}}]);return a}(i);export{H as FormItem,R as setErrorLevel};
