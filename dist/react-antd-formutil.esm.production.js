import{EasyField as e}from"react-formutil";export*from"react-formutil";import r from"@babel/runtime/helpers/esm/defineProperty";import t from"@babel/runtime/helpers/esm/toPropertyKey";import i from"@babel/runtime/helpers/esm/objectWithoutProperties";import a from"@babel/runtime/helpers/esm/classCallCheck";import o from"@babel/runtime/helpers/esm/createClass";import n from"@babel/runtime/helpers/esm/possibleConstructorReturn";import s from"@babel/runtime/helpers/esm/getPrototypeOf";import l from"@babel/runtime/helpers/esm/inherits";import c,{createContext as u,Children as f,cloneElement as m,Component as d}from"react";import{isValidElementType as p}from"react-is";import{Switch as v,Form as h,Checkbox as b,Radio as g,Transfer as y,Pagination as k,Upload as P}from"antd";import C from"react-fast-compare";var $=u({}),V=$.Consumer,_=$.Provider;var E=1;var F=function e(r){E=r};var j=v.name!=="Switch";var w=j?v:"Switch";var N=j?b:"Checkbox";var O=j?g:"Radio";var S=j?y:"Transfer";var T=j?k:"Pagination";var A=j?P:"Upload";function U(e){if(e){var r;var t=e.type;if(typeof t!=="string"&&p(t)){if(t.formutilType){return t.formutilType}if(j){return t}return t.displayName||t.name}return((r=e.props)===null||r===void 0?void 0:r.type)||t}}var L=function(u){l(d,u);function d(){var e;var r;a(this,d);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++){i[o]=arguments[o]}r=n(this,(e=s(d)).call.apply(e,[this].concat(i)));r.fields={};r.registerField=function(e,t){return t?r.fields[e]=t:delete r.fields[e]};r.latestValidationProps=null;r.fetchCurrentValidationProps=function(e){var t=Object.keys(r.fields).map(function(e){return r.fields[e].$new()});var i=t.filter(function(e){return e.$invalid});var a=i.length>0;var o=t.some(function(e){return e.$dirty});var n=t.some(function(e){return e.$touched});var s=t.some(function(e){return e.$focused});var l=i.map(function(e){return e.$getFirstError()});return r.getValidationProps(e,a,o,n,s,l)};r.getValidationProps=function(e,t,i,a,o,n){var s;switch(e){case 0:s=t&&i&&a;break;case 1:s=t&&i;break;case 2:s=t;break;default:s=false;break}var l={className:[r.props.className,s&&"has-error",t?"is-invalid":"is-valid",i?"is-dirty":"is-pristine",a?"is-touched":"is-untouched",o?"is-focused":"is-unfocused"].filter(Boolean).join(" ")};if(s){Object.assign(l,{validateStatus:"error",help:n})}return l};return r}o(d,[{key:"componentDidMount",value:function e(){var r;(r=this.registerAncestorField)===null||r===void 0?void 0:r.call(this,this.props.name,this.$fieldutil)}},{key:"componentWillUnmount",value:function e(){var r;(r=this.registerAncestorField)===null||r===void 0?void 0:r.call(this,this.props.name,null)}},{key:"render",value:function a(){var o=this;var n=this.props;var s=n.children,l=n.itemProps,u=n.errorLevel,d=u===void 0?E:u,p=n.noStyle,v=i(n,["children","itemProps","errorLevel","noStyle"]);var b=v.name,g=i(v,["name"]);if(!n.name){var y=this.latestValidationProps=this.fetchCurrentValidationProps(d);Promise.resolve().then(function(){if(!C(o.latestValidationProps,o.fetchCurrentValidationProps(d))){o.forceUpdate()}});return c.createElement(_,{value:{registerField:this.registerField}},c.createElement(h.Item,Object.assign({},g,y),s))}var k=typeof s==="function"?s:f.only(s);var P=U(k);switch(P){case w:case N:case O:v.__TYPE__="checked";break;case T:if(!("$defaultValue"in v)){v.$defaultValue=1}break;case"checked":case"array":case"object":case"number":case"empty":v.__TYPE__=P;break;default:v.__TYPE__="empty";break}return c.createElement(e,Object.assign({},v,{passUtil:"$fieldutil",render:function e(a){var s,u,f;var v=n.valuePropName,b=v===void 0?"value":v,g=n.changePropName,y=g===void 0?"onChange":g,C=n.focusPropName,$=C===void 0?"onFocus":C,_=n.blurPropName,E=_===void 0?"onBlur":_;var F=a.$fieldutil,j=a[y],U=a[$],L=a[E],x=a[b],Y=i(a,["$fieldutil",y,$,E,b].map(t));var B=F.$invalid,I=F.$dirty,K=F.$touched,R=F.$focused,W=F.$getFirstError;var q;switch(P){case w:case N:case O:case"checked":var D=n.checked,M=D===void 0?true:D,z=n.unchecked,G=z===void 0?false:z;q={checked:x===M,onChange:function e(r){var t=r&&r.target?r.target.checked:r;j(t?M:G,r)}};break;case S:q={targetKeys:x,onChange:j};break;case T:q={current:x,onChange:j};break;case A:q={fileList:(s=x===null||x===void 0?void 0:x.fileList)!==null&&s!==void 0?s:x,onChange:j};break;default:q=(u={onCompositionEnd:function e(r){o.isComposition=false;delete o.compositionValue;j(r)},onCompositionStart:function e(){return o.isComposition=true}},r(u,y,function(e){if(o.isComposition){o.compositionValue=e.target[b];o.forceUpdate()}else{for(var r=arguments.length,t=new Array(r>1?r-1:0),i=1;i<r;i++){t[i-1]=arguments[i]}j.apply(void 0,[e].concat(t))}}),r(u,b,"compositionValue"in o?o.compositionValue:x),u);break}Object.assign(q,(f={},r(f,$,U),r(f,E,L),f));var H=typeof k==="function"?k(q):m(k,q);return c.createElement(V,null,function(e){var r=e.registerField;if(p){o.$fieldutil=F;o.registerAncestorField=r;return H}var t=o.getValidationProps(d,B,I,K,R,W());return c.createElement(h.Item,Object.assign({required:false},Y,l,t),H)})}}))}}]);return d}(d);export{L as FormItem,F as setErrorLevel};
