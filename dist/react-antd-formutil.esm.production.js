import{EasyField as e}from"react-formutil";export*from"react-formutil";import r from"@babel/runtime/helpers/esm/defineProperty";import t from"@babel/runtime/helpers/esm/toPropertyKey";import i from"@babel/runtime/helpers/esm/objectWithoutProperties";import o from"@babel/runtime/helpers/esm/classCallCheck";import n from"@babel/runtime/helpers/esm/createClass";import a from"@babel/runtime/helpers/esm/createSuper";import s from"@babel/runtime/helpers/esm/inherits";import l,{createContext as c,Children as u,cloneElement as f,Component as m}from"react";import{isValidElementType as p}from"react-is";import{Form as d,Pagination as v,Radio as h,Checkbox as b,Switch as g,Upload as y,Transfer as k}from"antd";import P from"react-fast-compare";var $=c(),C=$.Consumer,_=$.Provider;var V=1;var E=function e(r){V=r};function F(e){if(e){var r=e.type;if(p(r)){if(r.formutilType){return r.formutilType}if(typeof r==="string"&&e.props.type){return e.props.type}}return r||e}}var j=function(c){s(p,c);var m=a(p);function p(){var e;o(this,p);for(var r=arguments.length,t=new Array(r),i=0;i<r;i++){t[i]=arguments[i]}e=m.call.apply(m,[this].concat(t));e.fields={};e.registerField=function(r,t){return t?e.fields[r]=t:delete e.fields[r]};e.latestValidationProps=null;e.checkHasError=function(e,r,t,i,o){switch(e){case 0:return r&&t&&i;case 1:return r&&t;case 2:return r;default:return false}};e.fetchCurrentValidationProps=function(r){var t=Object.keys(e.fields).map(function(r){return e.fields[r].$new()});var i=t.filter(function(e){return e.$invalid});var o=i.length>0;var n=t.some(function(e){return e.$dirty});var a=t.some(function(e){return e.$touched});var s=t.some(function(e){return e.$focused});var l=i.map(function(e){return e.$getFirstError()});return e.getValidationProps(r,o,n,a,s,l)};e.getValidationProps=function(r,t,i,o,n,a){var s=e.checkHasError(r,t,i,o,n);var l={className:[e.props.className,s&&"has-error",t?"is-invalid":"is-valid",i?"is-dirty":"is-pristine",o?"is-touched":"is-untouched",n?"is-focused":"is-unfocused"].filter(Boolean).join(" ")};if(s){Object.assign(l,{validateStatus:"error",help:a})}return l};return e}n(p,[{key:"componentDidMount",value:function e(){var r;(r=this.registerAncestorField)===null||r===void 0?void 0:r.call(this,this.props.name,this.$fieldutil)}},{key:"componentWillUnmount",value:function e(){var r;(r=this.registerAncestorField)===null||r===void 0?void 0:r.call(this,this.props.name,null)}},{key:"render",value:function o(){var n=this;var a=this.props;var s=a.children,c=a.itemProps,m=a.errorLevel,p=m===void 0?V:m,$=a.noStyle,E=i(a,["children","itemProps","errorLevel","noStyle"]);if(!a.name){var j=this.latestValidationProps=this.fetchCurrentValidationProps(p);Promise.resolve().then(function(){if(!P(n.latestValidationProps,n.fetchCurrentValidationProps(p))){n.forceUpdate()}});return l.createElement(_,{value:this.registerField},l.createElement(d.Item,Object.assign({},E,j),s))}if(a.$memo===true){E.__DIFF__=s}var w=typeof s==="function"?s:u.only(s);var N=F(w);switch(N){case g:case b:case h:E.__TYPE__="checked";break;case v:if(!("$defaultValue"in E)){E.$defaultValue=1}break;case"checked":case"array":case"object":case"number":case"empty":E.__TYPE__=N;break;default:E.__TYPE__="empty";break}return l.createElement(e,Object.assign({},E,{passUtil:"$fieldutil",render:function e(o){var s,u,m;var P=a.valuePropName,_=P===void 0?"value":P,V=a.changePropName,F=V===void 0?"onChange":V,j=a.focusPropName,O=j===void 0?"onFocus":j,A=a.blurPropName,S=A===void 0?"onBlur":A;var T=o.$fieldutil,q=o[F],L=o[O],U=o[S],I=o[_],Y=i(o,["$fieldutil",F,O,S,_].map(t));var x=T.$invalid,B=T.$dirty,D=T.$touched,H=T.$focused,K=T.$getFirstError;var W;switch(N){case g:case b:case h:case"checked":var M=a.checked,z=M===void 0?true:M,G=a.unchecked,J=G===void 0?false:G;W={checked:I===z,onChange:function e(r){var t=r&&r.target?r.target.checked:r;q(t?z:J,r)}};break;case k:W={targetKeys:I,onChange:q};break;case v:W={current:I,onChange:q};break;case y:W={fileList:(s=I===null||I===void 0?void 0:I.fileList)!==null&&s!==void 0?s:I,onChange:q};break;default:W=(u={onCompositionEnd:function e(r){n.isComposition=false;delete n.compositionValue;q(r)},onCompositionStart:function e(){return n.isComposition=true}},r(u,F,function(e){if(n.isComposition){n.compositionValue=e.target[_];n.forceUpdate()}else{for(var r=arguments.length,t=new Array(r>1?r-1:0),i=1;i<r;i++){t[i-1]=arguments[i]}q.apply(void 0,[e].concat(t))}}),r(u,_,"compositionValue"in n?n.compositionValue:I),u);break}Object.assign(W,(m={},r(m,O,L),r(m,S,U),m));if(!Y.required&&E.required&&(!c||!("required"in c))){Y.required=true}var Q=typeof w==="function"?w(W):f(w,W);return l.createElement(C,null,function(e){if($){n.$fieldutil=T;n.registerAncestorField=e;return Q}var r=n.getValidationProps(p,x,B,D,H,K());return l.createElement(d.Item,Object.assign({},Y,c,r),Q)})}}))}}]);return p}(m);export{j as FormItem,E as setErrorLevel};
